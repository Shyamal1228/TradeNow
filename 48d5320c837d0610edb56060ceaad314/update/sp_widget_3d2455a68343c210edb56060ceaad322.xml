<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function(i18n,spModal,spUtil,$scope,$sce,$http) {
	/* widget controller */
	var c = this;

	// Flag to track if the map is visible or not
	c.mapVisible = false;

	// Function to show the map modal with the item's location
	c.showMap = function() {
		var url="https://maps.google.com/maps?q="+c.data.obj.latitude+","+c.data.obj.longitude+"&z=15&output=embed";
		//	console.log(url);
		$scope.detailFrame= $sce.trustAsResourceUrl(url);
		//alert(c.data.obj.latitude);
		c.mapVisible = !c.mapVisible;
	};

	/*Timer functions*/


	var interval;
	function startTimer(duration,display){
		var timer = duration, seconds;
		interval = setInterval(function(){
			seconds = parseInt(timer,10);
			if (seconds < 10)
				display.innerHTML = '0'+seconds;
			else
				display.innerHTML = seconds;
			if(timer<10){
				document.getElementById('reservation-timer-modal').style.backgroundColor = 'red';
			}
			if(--timer<0){
				clearInterval(interval);
				document.getElementById('reservation-timer-modal').style.display = 'none';
				document.getElementById('reservation-timer-modal').style.backgroundColor = '#004242';

			}
		},1000);
	}


	window.onload = function(){
		if($scope.data.obj.item_status === 'reserved'){
			console.log("Hello");
			var timerDuration = 30;
			console.log("Executing timer");
			document.getElementById('reservation-timer-modal').style.display = 'block';
			var display = document.getElementById('timer');
			startTimer(timerDuration,display);	
		}
	}

	function addToServer() {
		c.server.update().then(function(response) {
			if (response) {
				c.data.status = null;
				//alert('Update successful');
			} else {
				//alert('Update failed:', response.data.error);
			}
		});
	}


	// Function to handle item status changes
	c.Itembutton = function(st) {
		c.data.status=st;
		c.data.reservation_date ='';
		if(st === 'available'){
			clearInterval(interval);
			document.getElementById('reservation-timer-modal').style.display = 'none';
			document.getElementById('timer').innerHTML = '30';
			document.getElementById('reservation-timer-modal').style.backgroundColor = '#004242';
			addToServer();
		}

		else if(st=='reserved'){
			spUtil.addInfoMessage("Item will be reserved for "+c.data.timeProperty+ " seconds!");

			params = [
				'sysparm_query=numberLIKE'+$scope.data.obj.number,
				'sysparm_fields=number,sys_updated_on,reservation_time_ends_at',
			].join('&');
			$http.get('/api/now/table/x_1383179_tradenow_item_list?'+params).then(function(response){
				console.log(response.data);
				console.log(response.data.result[0].sys_updated_on);
				var timerDuration = 30;
				//console.log("Executing timer");
				document.getElementById('reservation-timer-modal').style.display = 'block';
				var display = document.getElementById('timer');
				startTimer(timerDuration,display);

				var date = new Date(response.data.result[0].sys_updated_on);
				date.setHours(date.getHours()-7);
				var reservation_date = new Date(response.data.result[0].sys_updated_on);
				reservation_date.setHours(reservation_date.getHours()-7);
				reservation_date.setSeconds(reservation_date.getSeconds()+30);
				addToServer();
			})
		} 
		else {
			addToServer();
		}

		// Update the server with the new item status
		//c.server.update();
	}

	// Watch for changes in item status and trigger a server update when relevant status changes occur
	spUtil.recordWatch($scope, 'x_1383179_tradenow_item_list', "statusINavailable,readypickup,reserved,claimed", function(response) {
		//console.log(response.data);
		// statusINavailable,readypickup,reserved,claimed
		c.server.update();
	});

	// Calculate the distance between the item's location and the logged-in user's location

	// Latitude and Longitude of the item and the user
	var lat1 = c.data.obj.latitude;
	var lng1 = c.data.obj.longitude;
	var lat2 = c.data.obj.loggedInUserLatitude;
	var lng2 = c.data.obj.loggedInUserLongitude;
	//console.log( lat1+" "+lng1+" "+ lat2+" "+lng2);

	// Haversine formula to calculate the great-circle distance between two points on the Earth's surface
	var toRadians = function(degrees) {
		return degrees * (Math.PI / 180);
	};

	var R = 6371; // Earth's radius in km
	var dLat = toRadians(lat2 - lat1);
	var dLng = toRadians(lng2 - lng1);
	var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
			Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
			Math.sin(dLng / 2) * Math.sin(dLng / 2);
	var c1 = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
	var d = R * c1; // Distance in km

	c.distance = Math.floor(d);

};
]]></client_script>
        <controller_as>c</controller_as>
        <css>* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  	font-family: "Poppins", sans-serif;
    font-weight: 300;
    font-style: normal;
}

.text {
    color: #000000;
    font-weight: bold;
}

.map {
    width: 5%;
    margin-left: 5px;
}

.line {
    border: none;
    height: 5px;
    width: 20%;
    background-color: #004c4c;
}

.poppins-extralight {
    font-family: "Poppins", sans-serif;
    font-weight: 200;
    font-style: normal;
}

.poppins-light {
    font-family: "Poppins", sans-serif;
    font-weight: 300;
    font-style: normal;
}

.poppins-regular {
    font-family: "Poppins", sans-serif;
    font-weight: 400;
    font-style: normal;
}

.poppins-semibold {
    font-family: "Poppins", sans-serif;
    font-weight: 600;
    font-style: normal;
}

body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background-color: #f0f0f0; /* Optional: to differentiate the background */
    margin: 0;
}

.container {
  	position: relative;
    background-color: #ffffff;
    max-width: 900px;
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    //box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    //border-radius: 10px;
    overflow: hidden;
    margin: 25px; /* This margin ensures spacing from the edges */
    padding: 25px;
}

.image {
    flex: 1 1 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    //background-color: #ff0000;
}

.image img {
    max-width: 100%;
    height: auto;
}

.content {
    flex: 1 1 50%;
    padding: 2.5rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

h1 {
    margin-bottom: 20px;
    font-size: 2em;
    color: #004c4c;
}

.description {
    margin-bottom: 20px;
}

.description p {
    margin-top: 10px;
    margin-bottom: 10px;
    color: #555555;
    font-size: 1.5rem;
}

.features {
    list-style: none;
    margin-bottom: 20px;
}

.features li {
    font-size: 1.5rem;
    margin-bottom: 10px;
    color: #555555;
}

.features li span {
    color: #ff0000;
}

.actions {
    display: flex;
    gap: 10px;
}

.claim-item,
.add-to-cart,
.reserve,
.cancel,
.viewmap{
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
}

.view-item-button {
    display: inline-block;
    padding: 1.3rem 2.5rem;
    background-color: #78c879;
    color: white;
    font-size: 1.4rem;
    //font-weight: bold;
    border: none;
    border-radius: 50px;
    box-shadow: 0 4px 8px rgba(120, 200, 121, 0.4);
    cursor: pointer;
    text-decoration: none;
}

.view-item-button:hover {
    background-color: #66b267;
}

.claim-item {
    background-color: #008080;
    color: #ffffff;
    box-shadow: 0 4px 8px rgba(23, 107, 135, 0.4);
    transition: background-color 0.3s ease;
}

.claim-item:hover {
    background-color: #006666;
}

.add-to-cart {
    background-color: #007bff;
    color: #ffffff;
    box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
    transition: background-color 0.3s ease;
}

.add-to-cart:hover {
    background-color: #0e65f0;
}

.reserve {
    background-color: #d49a3a;
    color: #ffffff;
    box-shadow: 0 4px 8px rgba(212, 154, 58, 0.4);
    transition: background-color 0.3s ease;
}

.reserve:hover {
    background-color: #d1870d;
}

.cancel {
    background-color: #e6070e;
    color: #ffffff;
    box-shadow: 0 4px 8px rgba(230, 7, 14, 0.4);
    transition: background-color 0.3s ease;
}

.cancel:hover {
    background-color: #bf060c;
}

.viewmap {
    background-color: #004c4c;
    color: #ffffff;
    box-shadow: 0 4px 8px rgba(0, 102, 102, 0.4);
    transition: background-color 0.3s ease;
}

.viewmap:hover {
    background-color: #006666;
}

@media (max-width: 768px) {
    .container {
        flex-direction: column;
      	margin:25px 0px;
    }

    .image,
    .content {
        flex: 1 1 100%;
    }
}

.claimed {
    background-color: #000000;
    padding: 10px;
    border-radius: 20px;
    color: #ffffff;
}

/*.bn632-hover {
    width: 130px;
    //font-size: 16px;
    font-weight: 600;
    color: #fff;
    cursor: pointer;
    height: 40px;
    text-align: center;
    border: none;
    background-size: 300% 100%;
    border-radius: 5px;
    transition: all .4s ease-in-out;
    margin: auto;
    display: flex;
    align-items: center;
    justify-content: center;
  float:right;
}

.bn632-hover:hover {
    background-position: 100% 0;
    transition: all .4s ease-in-out;
}

.bn632-hover:focus {
    outline: none;
}

.bn632-hover.bn26 {
    background-image: linear-gradient(
        to right,
        #04364A,
        #176B87,
        #64CCC5,
        #176B87
    );
    box-shadow: 0 4px 15px 0 rgba(65, 132, 234, 0.75);
}*/

.map-container {
    text-align: center;
    margin: 20px 0;
}

iframe {
    width: 100%;
    margin: 50px 0 0 0;
    //max-width: 600px;
    height: 300px;
    border: 0;
    max-width: 100%;
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    border-radius: 10px;
    overflow: hidden;
}


.icons{
  width:25px;
}

.svg{
  margin-left:-2px;
  margin-right:6px;
  margin-bottom:-4px;
}



/* The Modal (background) */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    padding-top: 150px; /* Location of the box */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
    position: relative;
    background-color: #fefefe;
    margin: auto;
    padding: 0px;
    border: 1px solid #888;
    width: 80%;
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
    -webkit-animation-name: animatetop;
    -webkit-animation-duration: 0.4s;
    animation-name: animatetop;
    animation-duration: 0.4s
}

/* Add Animation */
@-webkit-keyframes animatetop {
    from {top:-300px; opacity:0} 
    to {top:0; opacity:1}
}

@keyframes animatetop {
    from {top:-300px; opacity:0}
    to {top:0; opacity:1}
}

/* The Close Button */

span.close{
  cursor: pointer;
}
.close {
   // display: flex;
   // justify-content: flex-end;
  float:right;
  margin-top:3px;
  	margin-right:7px;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}

/* .modal-header {
    padding: 2px 16px;
    background-color: #5cb85c;
    color: white;
} */

.modal-body {padding: 2px 16px;}

/* .modal-footer {
    padding: 2px 16px;
    background-color: #5cb85c;
    color: white;
} */

.map{
  display:flex;
  align-items:center;
  justify-content:center;
  width:auto;
}
.map iframe{
  height:350px;
  width:100%;
  padding:0px 0px 15px 15px;
  margin-top: 30px;
}

.content&gt;h3{
  margin-top:20px;
  font-size:20px;
  font-weight:600;
  color:#006666
}
.fa-indent{
    color: #66b2b2;
    margin-left: 5px;
}

li&gt;i{
  color:#006666;
}



/* Tooltip container */
.features li {
  position: relative;
  //display: inline-block;
}

/* Tooltip text */
.features li .tooltiptext {
  visibility: hidden;
  width: 120px;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;
  position: absolute;
  z-index: 1;
  bottom: 125%; /* Position the tooltip above the text */
  left: 50%;
  margin-left: -60px;
  opacity: 0;
  transition: opacity 0.5s;
}

/* Tooltip arrow */
.features li .tooltiptext::after {
  content: "";
  position: absolute;
  top: 100%; /* At the bottom of the tooltip */
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: black transparent transparent transparent;
}

/* Show the tooltip text when you mouse over the tooltip container */
.features li:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}

.fas:hover{
  cursor:pointer;
  size:40px;
}

// dialouge box
  .overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    z-index: 1000;
    overflow: hidden;
  }
  .popup {
    background: white;
    padding: 30px;
    border-radius: 10px;
    text-align: center;
    position: relative;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    max-width: 600px;
    width: 100%;
    opacity: 0;
    transform: translateY(-100%);
    animation: slide-down 0.5s forwards;
  }
  .popup h2 {
    margin-top: 0;
    font-size: 24px;
    color: #333;
  }
.popup h4 {
    margin-top: 15px;
    //font-size: 12px;
    color: #333;
  }
  .popup .buttons {
    margin-top: 20px;
  }
  .popup .buttons button {
    margin: 0 10px;
    padding: 10px 25px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .popup .buttons .yes {
    background-color: #008080;
    color: white;
  }
  .popup .buttons .yes:hover {
    background-color: #006666;
  }
  .popup .buttons .no {
    background-color: #dc3545;
    color: white;
  }
  .popup .buttons .no:hover {
    background-color: #c82333;
  }
  .close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    font-size: 30px;
    cursor: pointer;
    color: #999;
    transition: color 0.3s;
  }
  .close-btn:hover {
    color: #666;
  }
  .confirm-btn {
    display: inline-block;
    padding: 10px 20px;
    margin-top: 20px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
    transition: background-color 0.3s;
  }
  .confirm-btn:hover {
    background-color: #0056b3;
  }
  @keyframes slide-down {
    from {
      opacity: 0;
      transform: translateY(-100%);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }


/*Reservation timer modal*/

.reservation-timer-modal {
	display: none;
  position: absolute;
  z-index: 1;
  left: 50%;
  transform: translateX(-50%);
  top: 0;
  color: white;
  width: max-content;
  height: max-content;
  background-color: #004242;
  padding-inline: 10px;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>item_details_widget</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  $(document).ready(function(){


	$('.popUpBtn').on('click', function(){
		$('#'+$(this).data('modal')).css('display','block');
	})


	$('span.close').on('click', function(){
		$('.modal').css('display','none');
		// $(this).closest('.modal').find('.dynamic-iframe').attr('src', '');
	})


	$(window).on('click', function(event){
		if (jQuery.inArray( event.target, $('.modal') ) != "-1") {
        	$('.modal').css('display','none');
    	}
	})



})

}]]></link>
        <name>Item details widget</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */

	var table_name = $sp.getParameter('table');
	var targetSysId = $sp.getParameter('sys_id');

	data.timeProperty = gs.getProperty('x_1383179_tradenow.reservation.duration');

	if(table_name){
		 // Created a GlideRecord object for fetching item details
		var itemDetailsGR = new GlideRecord(table_name);
		if (itemDetailsGR.get(targetSysId)){
			data.obj={
				sys_id:itemDetailsGR.getValue('sys_id'),
				lister:itemDetailsGR.getValue('lister_name'),
				name:itemDetailsGR.getValue('item_name'),
				lister_comment: itemDetailsGR.getElement('lister_comment') ,
				number:itemDetailsGR.getValue('number'),//added
				description:itemDetailsGR.getValue('description'),
				category:itemDetailsGR.getValue('category'),
				condition:itemDetailsGR.getValue('condition'),
				item_status:itemDetailsGR.getValue('status'),
				image_url: itemDetailsGR.getDisplayValue('image'),
				location: itemDetailsGR.getDisplayValue('lister_name.location'),
				// accessing field label
				lister_label:itemDetailsGR['lister_name'].getLabel(),
				listerLocation_label:itemDetailsGR['location'].getLabel(),
				itemStatus_label:itemDetailsGR['status'].getLabel(),
				item_condition_label:itemDetailsGR['condition'].getLabel(),
				item_category_label:itemDetailsGR['category'].getLabel(),
			};
			
			console.log(data.obj);

			// Fetch the display label for the item's current status from the sys_choice table
			var choiceGR = new GlideRecord('sys_choice');
			choiceGR.addQuery('name', 'x_1383179_tradenow_item_list');
			choiceGR.addQuery('element', 'status');
			choiceGR.addQuery('value', data.obj.item_status);
			choiceGR.query();
			if (choiceGR.next()) {
				var selectedLabel = choiceGR.getValue('label');
				data.obj.item_status_label=selectedLabel;
				//console.log('Selected Label: ' + selectedLabel);
			}

			// Get the name of the category from the 'x_1383179_tradenow_category_lookup' table
			var category_sys_id=data.obj.category;
			var categoryGR = new GlideRecord('x_1383179_tradenow_category_lookup');
			categoryGR.addQuery('sys_id', category_sys_id);
			categoryGR.query();
			if (categoryGR.next()) {
				var categoryName = categoryGR.getDisplayValue('name');
				data.obj.category = categoryName;
			}

			// Get the lister's user record
			var userId = data.obj.lister;
			var userGR = new GlideRecord('sys_user');
			userGR.addQuery('sys_id', userId);
			userGR.query();

			if (userGR.next()) {
				//var fullName = userGR;
				var fullName = userGR.getDisplayValue('name');
				var locationId = userGR.getValue('location');
				if (locationId) {
					var locationGR = new GlideRecord('cmn_location');
					locationGR.addQuery('sys_id', locationId);
					locationGR.query();
					if (locationGR.next()) {
						data.obj.latitude = locationGR.getValue('latitude');
						data.obj.longitude = locationGR.getValue('longitude');
					}
				}
				console.log("userGR="+userGR);
				data.obj.lister=fullName;
			}
			//data.details.push(obj);
		}

		// Get the logged-in user's latitude and longitude
		var userRecordGR = new GlideRecord('sys_user');
		userRecordGR.addQuery('sys_id', gs.getUserID());
		userRecordGR.query();

		if (userRecordGR.next()) {
			//var fullName = userGR;
			var locId = userRecordGR.getValue('location');
			if (locId) {
				var locGR = new GlideRecord('cmn_location');
				locGR.addQuery('sys_id', locId);
				locGR.query();
				if (locGR.next()) {
					data.obj.loggedInUserLatitude = locGR.getValue('latitude');
					data.obj.loggedInUserLongitude = locGR.getValue('longitude');
				}
				//console.log("loggedd in user Lat: " + data.obj.Logglatitude);
			}
		}

		// Increment the total number of watchers for the item
		if(!input){
			var record = new GlideRecord('x_1383179_tradenow_item_list');
			if (record.get(data.obj.sys_id)) {
				console.log("sys_id="+data.obj.sys_id);
				record.total_watchers = (record.total_watchers || 0) + 1;
				record.update();
				data.watch=record.total_watchers;
				console.log(data.watch);
			}
		}
	}

	// Update the item status based on the input provided
	if (input && input.status) {
		//console.log("Button clicked="+input.status);
		var itemStatus = new GlideRecordSecure('x_1383179_tradenow_item_list');
		itemStatus.addQuery('sys_id', targetSysId);
		itemStatus.query();
		if (itemStatus.next()) {
			itemStatus.setValue('status',input.status);
			console.log(input.reservation_date);
			itemStatus.setValue('reservation_time_ends_at',input.reservation_date);
			itemStatus.update();
		}
		return true;
	}

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>shyamal</sys_created_by>
        <sys_created_on>2024-06-30 08:08:32</sys_created_on>
        <sys_id>3d2455a68343c210edb56060ceaad322</sys_id>
        <sys_mod_count>63</sys_mod_count>
        <sys_name>Item details widget</sys_name>
        <sys_package display_value="TradeNow" source="x_1383179_tradenow">48d5320c837d0610edb56060ceaad314</sys_package>
        <sys_policy/>
        <sys_scope display_value="TradeNow">48d5320c837d0610edb56060ceaad314</sys_scope>
        <sys_update_name>sp_widget_3d2455a68343c210edb56060ceaad322</sys_update_name>
        <sys_updated_by>shyamal</sys_updated_by>
        <sys_updated_on>2024-07-17 15:11:58</sys_updated_on>
        <template><![CDATA[<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;600&display=swap');
</style>

<div class="container">
  <div id='reservation-timer-modal' class='reservation-timer-modal'>
    <div class='reservation-modal-content'>
      <p>Reservation time ends in 00:<span id="timer">30</span></p>
    </div>
  </div>
  <!-- Image section displaying the item's image -->
  <div class="image">
    <img src="{{data.obj.image_url}}" alt="{{ data.obj.name }}">
  </div>

  <div class="content">
    <!-- Item name and separator line -->
    <h1 style="margin-bottom: 0.5rem;" class="poppins-semibold">{{ data.obj.name }}</h1>
    <hr class="line" />

    <!-- Item details header -->
    <h3 class="poppins-light">Item details <i class="fa fa-indent"></i></h3>

    <!-- Item description -->
    <div class="description">
      <p class="poppins-regular">{{ data.obj.description }}</p>
    </div>

    <!-- Item features list -->
    <ul class="features">
      <li class="poppins-regular"><i class="fas fa-user" title="{{data.obj.lister_label}}"></i> {{data.obj.lister}}</li>
      <li class="poppins-regular"><i class="fas fa-map-marker-alt" title="{{data.obj.listerLocation_label}}"></i> {{data.obj.location}}</li>
      <li class="poppins-regular"><i class="fas fa-check-circle" title="{{data.obj.itemStatus_label}}"></i> {{data.obj.item_status_label.charAt(0).toUpperCase() + data.obj.item_status_label.slice(1)}}</li>
      <li class="poppins-regular"><i class="fas fa-clipboard-check" title="{{data.obj.item_condition_label}}"></i> {{data.obj.condition.charAt(0).toUpperCase()+data.obj.condition.slice(1)}}</li>
      <li class="poppins-regular"><i class="fas fa-tags" title="{{data.obj.item_category_label}}"></i> {{data.obj.category.charAt(0).toUpperCase() + data.obj.category.slice(1)}}</li>
      <li class="poppins-regular"><i class="fas fa-route" title="Distance"></i> {{c.distance }} KM away</li>
    </ul>

    <!-- Action buttons based on item status -->
    <div class="actions">
      <button ng-if="data.obj.item_status == 'available' || data.obj.item_status == 'reserved'" ng-click="c.Itembutton('readypickup')" class="claim-item">Claim Item</button>
      <button ng-if="data.obj.item_status == 'available'" ng-click="c.Itembutton('reserved')" class="reserve">Reserve</button>
      <button ng-show="data.obj.item_status == 'reserved'" ng-click="c.Itembutton('available')" class="cancel">Cancel Reservation</button>
      <button ng-show="data.obj.item_status == 'readypickup'" ng-click="c.Itembutton('claimed')" class="claim-item" id="confirmButton">Confirm Pick-Up</button>
      <button ng-click="c.showMap()" class="viewmap popUpBtn" data-modal="myModal1">View on Map</button>
    </div>
  </div>
</div>

<!-- Modal for displaying the map -->
<div id="myModal1" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <span class="close">Ã—</span>
      <div>
        <div class="map">
          <iframe src="{{detailFrame}}" frameborder="0" style="border:0"></iframe>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Dialog box for donation prompt -->
<div class="overlay" id="popupOverlay">
  <div class="popup">
    <span class="close-btn" id="closePopup">&times;</span>
    <h2 class="poppins-semibold">Support a Cause: Donate Today!</h2>
    <h4 class="poppins-regular">Do you want to donate to charities?</h4>
    <div class="buttons">
      <button class="yes poppins-light" id="donateYes">Yes</button>
      <button class="no poppins-light" id="donateNo">No</button>
    </div>
  </div>
</div>



<script>
  // Show the donation popup when the confirm button is clicked
  document.getElementById('confirmButton').onclick = function() {
    document.getElementById('popupOverlay').style.display = 'flex';
  };

  // Close the donation popup when the close button is clicked
  document.getElementById('closePopup').onclick = function() {
    document.getElementById('popupOverlay').style.display = 'none';
  };

  // Redirect to the charity organization page when 'Yes' is clicked
  document.getElementById('donateYes').onclick = function() {
    window.location.href = '/tradenow?id=charity_organization';
  };

  // Close the donation popup when 'No' is clicked
  document.getElementById('donateNo').onclick = function() {
    document.getElementById('popupOverlay').style.display = 'none';
  };
</script>

<!-- Load FontAwesome icons -->
<script src="https://kit.fontawesome.com/ebe15838fd.js" crossorigin="anonymous"></script>
]]></template>
    </sp_widget>
</record_update>
