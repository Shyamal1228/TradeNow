<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function(spUtil,$scope,$sce) {
  /* widget controller */
  var c = this;
	c.mapVisible = false;
	c.showMap = function() {
		var url="https://maps.google.com/maps?q="+c.data.obj.latitude+","+c.data.obj.longitude+"&z=15&output=embed";
	//	console.log(url);
		$scope.detailFrame= $sce.trustAsResourceUrl(url);
		//alert(c.data.obj.latitude);
		c.mapVisible = !c.mapVisible;
	};
	
		c.Itembutton = function(st) {
		c.data.status=st;
			
			if(st=='reserved'){
				spUtil.addInfoMessage("Item will be reserved for 30 sec !")
			}
		//c.server.update();
			c.server.update().then(function(response) {
      if (response) {
				c.data.status = null;
       //alert('Update successful');
      } else {
       //alert('Update failed:', response.data.error);
      }
    });
	}
	
	spUtil.recordWatch($scope, 'x_1383179_tradenow_item_list', "statusINavailable,readypickup,reserved,claimed", function(response) {
	//console.log(response.data);
		// statusINavailable,readypickup,reserved,claimed
		c.server.update();
});
	
	// calculate distance
	//c.calculateDistance = function() {
	var lat1 = c.data.obj.latitude;
		var lng1 = c.data.obj.longitude;
		var lat2 = c.data.obj.Logglatitude;
		var lng2 = c.data.obj.Logglongitude;
		console.log( lat1+" "+lng1+" "+ lat2+" "+lng2);

		// Haversine formula
		var toRadians = function(degrees) {
			return degrees * (Math.PI / 180);
		};

		var R = 6371; // Earth's radius in km
		var dLat = toRadians(lat2 - lat1);
		var dLng = toRadians(lng2 - lng1);
		var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
				Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
				Math.sin(dLng / 2) * Math.sin(dLng / 2);
		var c1 = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
		var d = R * c1; // Distance in km

		c.distance = Math.floor(d);
	//};
	
	//c.calculateDistance();
	
};]]></client_script>
        <controller_as>c</controller_as>
        <css>/** {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}
.text{
  color:#000000;
  font-weight:bold;
}
.map{
  width:5%;
  margin-left:5px;
}
.line{
  border: none;
  height: 5px;
  width: 20%;
  background-color:#000000;
}

.poppins-extralight {
  font-family: "Poppins", sans-serif;
  font-weight: 200;
  font-style: normal;
}

.poppins-light {
  font-family: "Poppins", sans-serif;
  font-weight: 300;
  font-style: normal;
}

.poppins-regular {
  font-family: "Poppins", sans-serif;
  font-weight: 400;
  font-style: normal;
}

.poppins-semibold {
  font-family: "Poppins", sans-serif;
  font-weight: 600;
  font-style: normal;
}


.container {
    background-color: #ffffff;
    max-width: 900px;
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    border-radius: 10px;
    overflow: hidden;
  	margin:55px 55px 25px 55px;
    padding: 25px 0;
}

.image {
    flex: 1 1 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    //background-color: #ff0000;
}

.image img {
    max-width: 100%;
    height: auto;
}

.content {
    flex: 1 1 50%;
    padding: 2.5rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

h1 {
    margin-bottom: 20px;
    font-size: 2em;
    color: #333333;
}

.description {
    margin-bottom: 20px;
}

.description p {
  	margin-top: 10px;
    margin-bottom: 10px;
    color: #555555;
  	font-size: 1.5rem;
}

.features {
    list-style: none;
    margin-bottom: 20px;
}

.features li {
  	font-size: 1.5rem;
    margin-bottom: 10px;
    color: #555555;
}

.features li span {
    color: #ff0000;
}

.actions {
    display: flex;
    gap: 10px;
}

.claim-item,
.add-to-cart,
.reserve,
.cancel{
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
  	
}

.view-item-button {
  display: inline-block;
  padding: 1.3rem 2.5rem;
  background-color: #78c879;
  color: white;
  font-size: 1.4rem;
  //font-weight: bold;
  border: none;
  border-radius: 50px;
  box-shadow: 0 4px 8px rgba(120, 200, 121, 0.4);
  cursor: pointer;
  text-decoration: none;
}

.view-item-button:hover {
  background-color: #66b267;
}

.claim-item {
    background-color: #176B87;
    color: #ffffff;
  	box-shadow: 0 4px 8px rgba(23, 107, 135, 0.4);
 		transition: background-color 0.3s ease;
}
.claim-item:hover {
  background-color: #0f566e;
}
.add-to-cart {
    background-color: #007bff;
    color: #ffffff;
  box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
  transition: background-color 0.3s ease;
}
.add-to-cart:hover {
  background-color:#0e65f0;
}
.reserve {
    background-color: #d49a3a;
    color: #ffffff;
  box-shadow: 0 4px 8px rgba(212, 154, 58, 0.4);
  transition: background-color 0.3s ease;
}
.reserve:hover {
  background-color: #d1870d;
}
.cancel {
    background-color: #e6070e;
    color: #ffffff;
  box-shadow: 0 4px 8px rgba(230, 7, 14, 0.4);
  transition: background-color 0.3s ease;
}
.cancel:hover {
  background-color:#bf060c;
}
@media (max-width: 768px) {
    .container {
        flex-direction: column;
    }

    .image,
    .content {
        flex: 1 1 100%;
    }
}

.claimed{
  background-color:#000000;
  padding:10px;
  border-radius:20px;
  color:#ffffff;
}


.bn632-hover {
  width: 130px;
  //font-size: 16px;
  font-weight: 600;
  color: #fff;
  cursor: pointer;
  height: 40px;
  text-align:center;
  border: none;
  background-size: 300% 100%;
  border-radius: 5px;
  moz-transition: all .4s ease-in-out;
  -o-transition: all .4s ease-in-out;
  -webkit-transition: all .4s ease-in-out;
  transition: all .4s ease-in-out;
  margin:auto;
  
    display: flex;
    align-items: center;
    justify-content: center;
  
}

.bn632-hover:hover {
  background-position: 100% 0;
  moz-transition: all .4s ease-in-out;
  -o-transition: all .4s ease-in-out;
  -webkit-transition: all .4s ease-in-out;
  transition: all .4s ease-in-out;
}

.bn632-hover:focus {
  outline: none;
}

.bn632-hover.bn26 {
  background-image: linear-gradient(
    to right,
    #04364A,
    #176B87,
    #64CCC5,
    #176B87
  );
  box-shadow: 0 4px 15px 0 rgba(65, 132, 234, 0.75);
}


.map-container {
  text-align: center;
  margin: 20px 0;
}

iframe {
  width: 100%;
  margin-top: 50px 0px 0px 0px;
  //max-width: 600px;
  height: 300px;
  border: 0;
  
    max-width: 100%;
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    border-radius: 10px;
    overflow: hidden;
  	margin:55px 0;
}
*/
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

.text {
    color: #000000;
    font-weight: bold;
}

.map {
    width: 5%;
    margin-left: 5px;
}

.line {
    border: none;
    height: 5px;
    width: 20%;
    background-color: #000000;
}

.poppins-extralight {
    font-family: "Poppins", sans-serif;
    font-weight: 200;
    font-style: normal;
}

.poppins-light {
    font-family: "Poppins", sans-serif;
    font-weight: 300;
    font-style: normal;
}

.poppins-regular {
    font-family: "Poppins", sans-serif;
    font-weight: 400;
    font-style: normal;
}

.poppins-semibold {
    font-family: "Poppins", sans-serif;
    font-weight: 600;
    font-style: normal;
}

body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background-color: #f0f0f0; /* Optional: to differentiate the background */
    margin: 0;
}

.container {
    background-color: #ffffff;
    max-width: 900px;
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    border-radius: 10px;
    overflow: hidden;
    margin: 25px; /* This margin ensures spacing from the edges */
    padding: 25px 0;
}

.image {
    flex: 1 1 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    //background-color: #ff0000;
}

.image img {
    max-width: 100%;
    height: auto;
}

.content {
    flex: 1 1 50%;
    padding: 2.5rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

h1 {
    margin-bottom: 20px;
    font-size: 2em;
    color: #333333;
}

.description {
    margin-bottom: 20px;
}

.description p {
    margin-top: 10px;
    margin-bottom: 10px;
    color: #555555;
    font-size: 1.5rem;
}

.features {
    list-style: none;
    margin-bottom: 20px;
}

.features li {
    font-size: 1.5rem;
    margin-bottom: 10px;
    color: #555555;
}

.features li span {
    color: #ff0000;
}

.actions {
    display: flex;
    gap: 10px;
}

.claim-item,
.add-to-cart,
.reserve,
.cancel {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
}

.view-item-button {
    display: inline-block;
    padding: 1.3rem 2.5rem;
    background-color: #78c879;
    color: white;
    font-size: 1.4rem;
    //font-weight: bold;
    border: none;
    border-radius: 50px;
    box-shadow: 0 4px 8px rgba(120, 200, 121, 0.4);
    cursor: pointer;
    text-decoration: none;
}

.view-item-button:hover {
    background-color: #66b267;
}

.claim-item {
    background-color: #176B87;
    color: #ffffff;
    box-shadow: 0 4px 8px rgba(23, 107, 135, 0.4);
    transition: background-color 0.3s ease;
}

.claim-item:hover {
    background-color: #0f566e;
}

.add-to-cart {
    background-color: #007bff;
    color: #ffffff;
    box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
    transition: background-color 0.3s ease;
}

.add-to-cart:hover {
    background-color: #0e65f0;
}

.reserve {
    background-color: #d49a3a;
    color: #ffffff;
    box-shadow: 0 4px 8px rgba(212, 154, 58, 0.4);
    transition: background-color 0.3s ease;
}

.reserve:hover {
    background-color: #d1870d;
}

.cancel {
    background-color: #e6070e;
    color: #ffffff;
    box-shadow: 0 4px 8px rgba(230, 7, 14, 0.4);
    transition: background-color 0.3s ease;
}

.cancel:hover {
    background-color: #bf060c;
}

@media (max-width: 768px) {
    .container {
        flex-direction: column;
    }

    .image,
    .content {
        flex: 1 1 100%;
    }
}

.claimed {
    background-color: #000000;
    padding: 10px;
    border-radius: 20px;
    color: #ffffff;
}

.bn632-hover {
    width: 130px;
    //font-size: 16px;
    font-weight: 600;
    color: #fff;
    cursor: pointer;
    height: 40px;
    text-align: center;
    border: none;
    background-size: 300% 100%;
    border-radius: 5px;
    transition: all .4s ease-in-out;
    margin: auto;
    display: flex;
    align-items: center;
    justify-content: center;
}

.bn632-hover:hover {
    background-position: 100% 0;
    transition: all .4s ease-in-out;
}

.bn632-hover:focus {
    outline: none;
}

.bn632-hover.bn26 {
    background-image: linear-gradient(
        to right,
        #04364A,
        #176B87,
        #64CCC5,
        #176B87
    );
    box-shadow: 0 4px 15px 0 rgba(65, 132, 234, 0.75);
}

.map-container {
    text-align: center;
    margin: 20px 0;
}

iframe {
    width: 100%;
    margin: 50px 0 0 0;
    //max-width: 600px;
    height: 300px;
    border: 0;
    max-width: 100%;
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    border-radius: 10px;
    overflow: hidden;
}
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>item_details_testing</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Item details Testing</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
	
	var table_name = $sp.getParameter('table');
	var targetSysId = $sp.getParameter('sys_id');
	
	//console.log(table_name);
	//console.log(targetSysId);
	//data.details = [];
	if(table_name){
  var gr = new GlideRecord(table_name);
	if (gr.get(targetSysId)){
		data.obj={
			sys_id:gr.getValue('sys_id'),
			lister:gr.getValue('lister_name'),
			name:gr.getValue('item_name'),
			description:gr.getValue('description'),
			category:gr.getValue('category'),
			condition:gr.getValue('condition'),
			item_status:gr.getValue('status'),
			image_url: gr.getDisplayValue('image'),
			location: gr.getDisplayValue('lister_name.location')
		};
		var category_sys_id=data.obj.category;
		var catGR = new GlideRecord('x_1383179_tradenow_category_lookup');
		catGR.addQuery('sys_id', category_sys_id);
		catGR.query();
		if (catGR.next()) {
			var categoryName = catGR.getDisplayValue('name');
			data.obj.category = categoryName;
		}
		
		console.log("######Status##### "+data.obj.item_status);
		
		/*var attachmentGr = new GlideRecord('sys_attachment');
		attachmentGr.addQuery('table_sys_id', targetSysId);
		attachmentGr.query();
		
		if (attachmentGr.next()) {
			data.obj.image_url = '/sys_attachment.do?sys_id=' + attachmentGr.getValue('sys_id');
		}*/
		
		
		var userId = data.obj.lister;

		var userGR = new GlideRecord('sys_user');
		userGR.addQuery('sys_id', userId);
		userGR.query();

		if (userGR.next()) {
			//var fullName = userGR;
			 var fullName = userGR.getDisplayValue('name');
			var locationId = userGR.getValue('location');
			if (locationId) {
				var locationGR = new GlideRecord('cmn_location');
				locationGR.addQuery('sys_id', locationId);
				locationGR.query();
				if (locationGR.next()) {
					data.obj.latitude = locationGR.getValue('latitude');
					data.obj.longitude = locationGR.getValue('longitude');
				}
				//console.log("Lat: " + data.obj.latitude);
			}
			console.log("userGR="+userGR);
			data.obj.lister=fullName;
		}
	//data.details.push(obj);
	}
		
		// logged in user long, lati
		var userRecord = new GlideRecord('sys_user');
    userRecord.addQuery('sys_id', gs.getUserID());
    userRecord.query();
		
		if (userRecord.next()) {
			//var fullName = userGR;
			var locId = userRecord.getValue('location');
			if (locId) {
				var locGR = new GlideRecord('cmn_location');
				locGR.addQuery('sys_id', locId);
				locGR.query();
				if (locGR.next()) {
					data.obj.Logglatitude = locGR.getValue('latitude');
					data.obj.Logglongitude = locGR.getValue('longitude');
				}
				//console.log("loggedd in user Lat: " + data.obj.Logglatitude);
			}
		}
		
		
		// total watching
		if(!input){
			var record = new GlideRecord('x_1383179_tradenow_item_list');
		if (record.get(data.obj.sys_id)) {
			console.log("sys_id="+data.obj.sys_id);
			record.total_watchers = (record.total_watchers || 0) + 1;
			record.update();
			data.watch=record.total_watchers;
			console.log(data.watch);
		}
		}
}
	
	if (input && input.status) {
		console.log("Button clicked="+input.status);

	var grClaimItem = new GlideRecordSecure('x_1383179_tradenow_item_list');
	grClaimItem.addQuery('sys_id', targetSysId);
	grClaimItem.query();
	if (grClaimItem.next()) {
			grClaimItem.setValue('status',input.status);
			grClaimItem.update();
	}
		
		return true;
	}
	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>shyamal</sys_created_by>
        <sys_created_on>2024-06-11 06:51:22</sys_created_on>
        <sys_id>9e4c039083fe8210edb56060ceaad372</sys_id>
        <sys_mod_count>28</sys_mod_count>
        <sys_name>Item details Testing</sys_name>
        <sys_package display_value="TradeNow" source="x_1383179_tradenow">48d5320c837d0610edb56060ceaad314</sys_package>
        <sys_policy/>
        <sys_scope display_value="TradeNow">48d5320c837d0610edb56060ceaad314</sys_scope>
        <sys_update_name>sp_widget_9e4c039083fe8210edb56060ceaad372</sys_update_name>
        <sys_updated_by>shyamal</sys_updated_by>
        <sys_updated_on>2024-06-11 17:59:21</sys_updated_on>
        <template><![CDATA[
<div class="container">
  <div class="image">
    <!--<img src="https://fadzrinmadu.github.io/hosted-assets/product-detail-page-design-with-image-slider-html-css-and-javascript/shoe_1.jpg" alt="Nike Shoes">-->
    <img src="{{data.obj.image_url}}" alt="{{ data.obj.name }}">
  </div>
  <div class="content">
    <h1 style="margin-bottom: 0.5rem;" class="poppins-semibold">{{ data.obj.name }}</h1>
    <hr class="line" />
    <div class="description">
      <p class="poppins-regular">{{ data.obj.description }}</p>
    </div>
    <ul class="features">

      <li class="poppins-regular"> <i class="fa fa-circle" style="color: #176B87; margin-right:5px;"></i><strong>Available:</strong> in stock</li>
      <li class="poppins-regular"><i class="fa fa-circle" style="color: #176B87; margin-right:5px;"></i><strong>Category:</strong> {{data.obj.category}}</li>
      <li class="poppins-regular"><i class="fa fa-circle" style="color: #176B87; margin-right:5px;"></i><strong>Condition:</strong> {{data.obj.condition}}</li>
      <li class="poppins-regular"><i class="fa fa-circle" style="color: #176B87; margin-right:5px;"></i><strong>Item Lister:</strong> {{data.obj.lister}}</li>
      <!--<li class="poppins-regular"><i class="fa fa-circle" style="color: #176B87; margin-right:5px;"></i><strong>Item Location:</strong><a target="_blank" href="https://www.google.com/maps?q={{data.obj.latitude}},{{data.obj.longitude}}"><button class="bn632-hover bn26 poppins-regular">View location</button></a></li>-->
      <li class="poppins-regular"><i class="fa fa-circle" style="color: #176B87; margin-right:5px;"></i><strong>Item Location:</strong> {{data.obj.location}}</li>
      <li class="poppins-regular"><i class="fa fa-circle" style="color: #176B87; margin-right:5px;"></i><strong>Item Distance:</strong> {{c.distance }} KM away</li>

    </ul>
   <!-- <div class="actions">
      <button ng-if="data.obj.item_status == 'available' || data.obj.item_status == 'reserved'" ng-click="c.Itembutton('readypickup')" class="claim-item">Claim Item</button>
      <button ng-show="data.obj.item_status == 'available'" ng-click="c.Itembutton('reserved')" class="reserve">Reserve</button>
      <button ng-show="data.obj.item_status == 'reserved'" ng-click="c.Itembutton('available')" class="cancel">Cancel Reservation</button>
      <h2 ng-if="data.obj.item_status == 'claimed'" class="claimed">Item has been Claimed </h2>
      <button ng-if="data.obj.item_status == 'readypickup'" ng-click="c.Itembutton('claimed')" class="claim-item">Confirm Pick-Up</button>
      
  </div>-->
    
     <div class="actions">
      <button ng-if="data.obj.item_status == 'available' || data.obj.item_status == 'reserved'" ng-click="c.Itembutton('readypickup')" class="claim-item">Claim Item</button>
      <button ng-if="data.obj.item_status == 'available'" ng-click="c.Itembutton('reserved')" class="reserve">Reserve</button>
      <button ng-show="data.obj.item_status == 'reserved'" ng-click="c.Itembutton('available')" class="cancel">Cancel Reservation</button>
      <h2 ng-if="data.obj.item_status == 'claimed'" class="claimed">Item has been Claimed </h2>
      <button ng-if="data.obj.item_status == 'readypickup'" ng-click="c.Itembutton('claimed')" class="claim-item">Confirm Pick-Up</button>
      
  </div>
  <!--<p>
    {{data.obj.latitude}} {{data.obj.longitude}}
  </p>-->
  <!--<p> Distance is 
    {{c.distance }} KM
  </p>-->
    
</div>
  
</div>
<button style="margin-bottom: 20px;" ng-click="c.showMap()" class="bn632-hover bn26 poppins-regular">{{c.mapVisible==false ? 'View on Map':'Hide Map'}}</button></a>
<div>
  <!--<iframe ng-show="c.mapVisible" src="https://maps.google.com/maps?q=50.085273, 14.40448&z=15&output=embed" frameborder="0" style="border:0"></iframe>-->
  <iframe ng-show="c.mapVisible" ng-src="{{detailFrame}}"></iframe>
</div>
]]></template>
    </sp_widget>
</record_update>
